#+title: Config
* Table of Content                 :TOC:
- [[#doom-config][Doom config]]
  - [[#head][Head]]
  - [[#name][Name]]
  - [[#font][Font]]
  - [[#theme][Theme]]
  - [[#line-nums][Line nums]]
  - [[#org-directory][Org directory]]
- [[#ui][UI]]
- [[#app][App]]
  - [[#telega][Telega]]
  - [[#rime][Rime]]
  - [[#elfeed][Elfeed]]
- [[#org-mode][Org-mode]]
  - [[#settings][settings]]
  - [[#prettify][Prettify]]
  - [[#org-roam][Org-roam]]
  - [[#latex][LaTex]]
  - [[#org-agenda][Org-agenda]]
  - [[#buffer-timer][Buffer timer]]
  - [[#english-helper][English-helper]]
- [[#meow][Meow]]
  - [[#other-keymap][Other keymap]]
- [[#search][Search]]
  - [[#cregexp-for-vertico][cregexp for vertico]]
- [[#package][Package]]
- [[#init][Init]]

* Doom config
** Head
#+begin_src emacs-lisp :tangle yes
;;; $DOOMDIR/config.el -*- lexical-binding: t; -*-
#+end_src
** Name
#+begin_src emacs-lisp :tangle yes
(setq user-full-name "weland"
      user-mail-address "welandx@gmail.com")
#+end_src
** Font
#+begin_src emacs-lisp :tangle yes
(setq doom-font (font-spec :family "IBM Plex Mono" :size 20)
      doom-variable-pitch-font (font-spec :family "overpass" :size 20)
      doom-unicode-font (font-spec :family "LXGW wenkai" :size 22)
      doom-serif-font (font-spec :family "Dejavu Sans Mono" :size 20)
)
#+end_src
** Theme
#+begin_src emacs-lisp :tangle yes
(setq doom-theme 'kaolin-ocean)
#+end_src
** Line nums
#+begin_src emacs-lisp :tangle yes
(setq display-line-numbers-type t)
#+end_src
** Org directory
#+begin_src emacs-lisp :tangle yes
(setq org-directory "~/org/")
#+end_src
* UI
only for emacs >= 29, true transparent
#+begin_src emacs-lisp :tangle yes
(setq default-frame-alist (append default-frame-alist '((alpha-background . 85))))
#+end_src
* App
** Telega
telegram client in emacs
#+begin_src emacs-lisp :tangle yes
(use-package! telega
  :defer t
  :bind
  ("C-c i t" . telega)
  :config
  (setq telega-proxies   (list '(:server "127.0.0.1":port 7891 :enable t :type (:@type "proxyTypeSocks5") )))
  (telega-notifications-mode t)
  (telega-mode-line-mode 1))

(with-eval-after-load 'telega
  (global-set-key (kbd "C-c C-s") 'telega-sticker-choose-favorite-or-recent)
  (define-key telega-msg-button-map "k" nil)
  (define-key telega-msg-button-map "l" nil)
  (define-key telega-msg-button-map "h" nil))
#+end_src
** Rime
chinese input method, depend on librime;Instead of use pyim, it's better to use system input method
which has great performance
#+begin_src emacs-lisp :tangle yes
(use-package! rime
  :defer t
  :custom
  (default-input-method "rime")
  :config
  (setq rime-user-data-dir "~/.config/erime")
  (setq rime-show-candidate 'minibuffer) ;; 候选样式
  (setq rime-disable-predicates
        '(
          rime-predicate-current-input-punctuation-p
          rime-predicate-after-alphabet-char-p
          meow-normal-mode-p
          rime-predicate-current-uppercase-letter-p
          )))
#+end_src
** Elfeed
RSS: news
#+begin_src emacs-lisp :tangle yes
;;(use-package! elfeed)
#+end_src
* Org-mode
** settings
#+begin_src emacs-lisp :tangle yes
(after! org
  (setq org-format-latex-options (plist-put org-format-latex-options :scale 1.2))
  (setq org-special-ctrl-a/e t)
  (setq org-hide-emphasis-markers t)
  (setq org-pretty-entities t)
  )
#+end_src
** Prettify
Disable line numbers display

#+begin_src emacs-lisp :tangle yes
(add-hook 'org-mode-hook
           'doom-disable-line-numbers-h)
#+end_src

display in center
#+begin_src emacs-lisp :tangle yes
(use-package! olivetti
  :hook
  (org-mode . olivetti-mode))
#+end_src

** Org-roam
add tags
#+begin_src emacs-lisp :tangle yes
(after! org-roam
  (defvar org-roam-capture-templates
    '(("d" "default" plain "%?"
       :target (file+head "%<%Y%m%d%H%M%S>-${slug}.org"
                          "#+title: ${title}\n#+filetags: ")
       :unnarrowed t)) )
  )
#+end_src

ripgrep in roam

=this moudle has some terrible errors=
#+begin_src emacs-lisp :tangle yes
(use-package! consult-org-roam
   :defer t
   ;; :init
   ;; (require 'consult-org-roam)
   ;; ;; Activate the minor-mode
   ;; (consult-org-roam-mode 1)
   :after org-roam
   :custom
   (consult-org-roam-grep-func #'consult-ripgrep)
   :config
   ;; Eventually suppress previewing for certain functions
   (consult-customize
    consult-org-roam-forward-links
    :preview-key (kbd "M-."))
   :bind
   ("C-c n r x" . consult-org-roam-search))
#+end_src
** LaTex

*** Laas
Quick snippet in LaTex buffer
#+begin_src emacs-lisp :tangle yes
(use-package! laas
  :hook (LaTeX-mode . laas-mode)
  :config ; do whatever here
  (aas-set-snippets 'laas-mode
                    ;; set condition!
                    :cond #'texmathp ; expand only while in math
                    "supp" "\\supp"
                    "On" "O(n)"
                    "O1" "O(1)"
                    "Olog" "O(\\log n)"
                    "Olon" "O(n \\log n)"
                    "ali" "aligned"
                    ;; bind to functions!
                    "Sum" (lambda () (interactive)
                            (yas-expand-snippet "\\sum\\limits_{$1}^{$2} $0"))
                    "Span" (lambda () (interactive)
                             (yas-expand-snippet "\\Span($1)$0"))
                    "beg" (lambda () (interactive)
                            (yas-expand-snippet "\\begin{$1}\n $0 \n \\end{$1}"))
                    "{lr" (lambda () (interactive)
                            (yas-expand-snippet "\\lbrace $1 \\rbrace"))
                    "(lr" (lambda () (interactive)
                            (yas-expand-snippet "\\lparen $1 \\rparen"))
                    "[lr" (lambda () (interactive)
                            (yas-expand-snippet "\\lbrack $1 \\rbrack"))
                    "pro" (lambda () (interactive)
                            (yas-expand-snippet "\\prod\\limits_{$1}^{$2} $0"))
                    ;; add accent snippets
                    :cond #'laas-object-on-left-condition
                    "qq" (lambda () (interactive) (laas-wrap-previous-object "sqrt"))))
#+end_src
*** Org-fragtog
Auto toggle preview display
#+begin_src emacs-lisp :tangle yes
(use-package! org-fragtog
  :hook (org-mode . org-fragtog-mode))
#+end_src
** Org-agenda
use org-roam-daily as agenda file
#+begin_src emacs-lisp :tangle yes
(setq org-agenda-files '("~/org/roam/daily"))
#+end_src
** Buffer timer
record time

=buffer-timer-file-name= should be specific
#+begin_src emacs-lisp :tangle yes
(after! org-roam
  (add-load-path! "~/.doom.d/site-lisp/elisp-buffer-timer")
  (require 'buffer-timer)
(setq buffer-timer-idle-limit 100)
;; Example list of titles and regexps to group by.  This
(setq buffer-timer-regexp-master-list
  '(
    ("idle" .
     (("generic" .			  "^\\*idle\\*")
      ("generic2" .			  "^\\*idle-2\\*")
      ("minibuf" .                        "^ \\*Minibuf-.*")))
    ("personal" .
     (("reading" .                        "lib/ebooks/")
      ("daily" .                        "daily")
      ("study" .
       (
       ("math" .                   "org/roam/math")
       ("CS"  .                     "org/roam/computer-science")
       ("politic" .                 "org/roam/politic")
       ("generic" .                 "org/roam")
       ))
      ("Social" .
       (("generic" .                "Telega")
       ("hp" .                      "Guang")
       ("emacs" .                   "emacs_zh")))
      ("config" .                    "conf")))
    ("work" .
      (("python" . "code/python")
       ("c++" . "code/cpp")
       ))
     ))

  )
#+end_src
** English-helper
base on corfu
#+begin_src emacs-lisp :tangle yes
(use-package! corfu
  :defer t)

(use-package! corfu-english-helper
  :defer t)

(after! posframe
  (defun my/delete-corfu ()
    (posframe-delete " *corfu*")))
#+end_src
* Meow
map key in meow normal mode:
1. system clipboard
2. comment
#+begin_src emacs-lisp :tangle yes
(map! :map meow-normal-state-keymap
      ("P" #'meow-clipboard-yank)
      ("S" #'meow-clipboard-save)
      ("M" #'meow-comment)
        )
#+end_src

there is also ~meow-keypad-state-keymap~, but it's unnecessary to map this.

** Other keymap
#+begin_src emacs-lisp :tangle yes
(global-set-key (kbd "C-c w") 'other-window)
(global-set-key (kbd "C-s") '+default/search-buffer) ;; go to line
(global-set-key (kbd "C-c b") 'switch-to-buffer)

(after! yasnippet
  (map! "M-/" #'yas-expand))
#+end_src
* Search
** cregexp for vertico
现在, 可以使用 =拼音= 搜索 vertico 的选项, 这得益于 pinyinlib, 由 pyim 的作者提供完整的解决方法, 依赖于 pyim
#+begin_src emacs-lisp :tangle yes
(after! vertico
  (require 'pyim-cregexp-utils)
  (defun my-orderless-regexp (orig-func component)
    (let ((result (funcall orig-func component)))
      (pyim-cregexp-build result)))

  (advice-add 'orderless-regexp :around #'my-orderless-regexp))
#+end_src
* Package
#+begin_src emacs-lisp :tangle packages.el
;; -*- no-byte-compile: t; -*-
;;; $DOOMDIR/packages.el

(package! telega)
(package! rime)
(package! kaolin-themes)
(package! olivetti)
(package! laas)
(package! pyim)
(package! orderless)
(package! org-fragtog)
(package! consult-org-roam)
(package! wakatime-mode)
(package! corfu)
(package! corfu-english-helper
  :recipe (:host github :repo "manateelazycat/corfu-english-helper"))
#+end_src
* Init
~init.el~ load before ~config.el~, so set tangle to nil in this part
#+begin_src emacs-lisp :tangle no
:lang
        (org +pretty +roam2)

:app
        (rss +org)

:config
        literate
#+end_src
